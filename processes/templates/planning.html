{% extends 'processes/base.html' %}
{% block content %}
<style>
   hr {
    margin-top: 4pt;
    margin-bottom: 4pt;
    border: none; /* Убираем границу */
    background-color: #D3D3D3; /* Цвет линии */
    color: #D3D3D3; /* Цвет линии для IE6-7 */
    height: 1px; /* Толщина линии */
   }
  </style>
<script type="text/javascript">
$(document).ready(function(){
  var dp = $('#datepicker');
  dp.datepicker({
    format: "dd/mm/yyyy",
    language: "ru",
    startDate: "today",
    todayHighlight: true
  });
  $('#formula').trigger("change");
  addValidation();
});</script>

<div class="panel panel-default" style ="margin: auto">
  <div class="panel-heading">
      <h4 class="panel-title">Добавление процесса</h4>
  </div>
  {% if error_message %}
  <p><strong>{{ error_message }}</strong></p>
  {% endif %}
<div class="panel-body">
  <div class="input-group" style ="margin: auto">
    <form action="save_process/" method="post" class="form-horizontal">
      {% csrf_token %}
      <div class="form-group">
        <label for="process" class="col-sm-2 control-label" style="font-size: medium">Процесс: </label>
        <div class="col-sm-10">
        <select class="form-control" id="process" name="process">
          <option value="1" selected>Смешение</option>
          <option value="2">Фасовка</option>
          </select>
        </div>
        </div>
        <div class="input-daterange input-group" id="datepicker">
          <div class="form-group"><label for="start" class="col-sm-2 control-label" style="font-size: medium">Дата начала: </label>
          <div class="col-sm-10"><input type="text" data-provide="datepicker" class="input-sm form-control" name="start" /></div></div>
          <div class="form-group"><label for="end" class="col-sm-2 control-label" style="font-size: medium">Дата конца: </label>
          <div class="col-sm-10"><input type="text" data-provide="datepicker" class="input-sm form-control" name="end" /></div>
        </div>
        </div>
  <div class="form-group"><label for="ammount" class="col-sm-2 control-label" style="font-size: medium">Объём: </label><div class="col-sm-10"><div class="input-group"><input id="ammount" name="ammount" type="number" value="0" min="0" class="form-control" onchange="changeMinMax({{components}}, {{f}});changeWater();return false;" value="{{list.ammount}}"><span class="input-group-addon">кг</span></div></div>
</div>
<div class="form-group">
  <label for="formula" class="col-sm-2 control-label" style="font-size: medium">Реактор: </label>
  <div class="col-sm-10">
  <select class="form-control" id="reactor" name="reactor">
    {% for r in reactors %}
    <option value="{{ r.id }}">{{ r }}</option>
    {% endfor %}</select>
  </div>
</div>
      <div class="form-group">
        <label for="formula" class="col-sm-2 control-label" style="font-size: medium">Состав: </label>
        <div class="col-sm-10">
        <select class="form-control" id="formula" name="formula" onchange="getComponents({{components}}, {{materials}}, {{f_c}}, {{f}});changeWater();return false;">
          {% for f in formulas %}
          <option value="{{ f.id }}">{{ f }}</option>
          {% endfor %}</select>
        </div>
      </div>
      <br><br>
      <div class="col-sm-12">
      <div class="col-sm-6">
      <div class="panel panel-default" style ="margin: auto">
        <div class="panel-heading"><b><h4 class="panel-title">Состав</h4></b></div>
        <div class="panel-body">
      <table class="table table-sm" id="materials" style="width:100%; margin: auto">
        <thead>
          <tr>
            <th>Код</th><th>Наименование</th><th>Мин., кг</th><th>Макс., кг</th><th>Количество, кг</th><th>В загрузочном листе, кг</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ВД01</td>
            <td>Вода</td>
            <td>-</td>
            <td>-</td>
            <td id="water"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="col-sm-6">
<div class="panel panel-default" style ="margin: auto">
  <div class="panel-heading"><b><h4 class="panel-title">Загрузочный лист</h4></b>
    <hr>
  <button class="btn btn-success" data-toggle="modal" data-target="#newComp"><i class="glyphicon glyphicon-plus"></i> Добавить реактив</button>
  <button class="btn btn-success" data-toggle="modal" data-target="#newComp"><i class="glyphicon glyphicon-plus"></i> Добавить составной компонент</button>
  <div class="modal fade" id="newComp">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button class="close" data-dismiss="modal">x</button>
          <h4>Добавление реактива</h4>
        </div>
        <div class="modal-body">
  <div style="margin: auto">
    <label for="material">Реактив:</label>
    <select class="form-control" id="material">
      {% for m in materials %}
      <option value="{{ m.code }}">{{ m.get_name }}</option>
      {% endfor %}</select>
      <br>
      <label for="min">Минимум:</label>
      <div class="input-group">
        <input type="number" class="form-control bfh-number" max="100" min="0"  value="100" id="min"> <span class="input-group-addon">%</span></p>
      </div>
      <br>
      <label for="max">Максимум:</label>
      <div class="input-group">
        <input type="number" class="form-control bfh-number" max="100" min="0"  value="100" id="max"> <span class="input-group-addon">%</span></p>
      </div>
  </div>
</div>
<div class="modal-footer"><button type="button" class="btn btn-primary" onclick="addRow('components');return false;" data-dismiss="modal">Добавить</button></div>
</div>
</div>
</div>
</div>
  <div class="panel-body">
<table class="table table-sm" id="materials" style="width:100%; margin: auto">
  <thead>
    <tr>
      <th>Код</th><th>Наименование</th><th>Количество, кг</th><th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ВД01</td>
      <td>Вода</td>
      <td id="water"></td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
      <br>
      <input type="hidden" id="json" name="json" value="">
      <input type="submit" id="send" value="Сохранить" class="btn btn-primary" style="float: right"/>
  </div>
  </form>
</div>
</div>
{% endblock content %}
